<!DOCTYPE html> 
<html lang="fr">
<head>

	<!-- Google Tag Manager -->
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-5X9NDHBP');</script>
	<!-- End Google Tag Manager -->
	
  <meta charset="UTF-8">
  <title>Trombinoscope 2025</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin:0; padding:0;
      background: url("Ec's.png") no-repeat center center fixed;
      background-size: cover;
    }
    body::before {
      content: "";
      position: fixed;
      top:0; left:0; width:100%; height:100%;
      background: rgba(255,255,255,0.7);
      z-index: -1;
    }
    .container { 
      display:flex; 
      margin-top:70px; 
      justify-content:center; 
      align-items:flex-start;
    }
    .game { 
      flex:2; 
      padding:20px; 
      font-size: 1.2em; 
      max-width:650px; 
      text-align:center; 
      margin-right:20px;
    }
    .toolbox { 
      flex:1; 
      background:#fff; 
      padding:15px; 
      border-left:2px solid #ccc; 
      font-size:1em; 
      max-width:500px;
    }
    .box { margin-bottom:20px; padding:10px; border:1px solid #ccc; border-radius:8px; }
    .error { color:red; font-size:0.9em; position:absolute; top:5px; right:10px; }
    button { margin-top:5px; font-size:1em; padding:6px 10px; }

    /* Bandeau supérieur */
    .header {
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 60px;
      background: black;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: "Old English Text MT", "Gothic Old English", serif;
      font-size: 32px;
      letter-spacing: 2px;
      z-index: 1000;
    }
    .header img {
      position: absolute;
      right: 15px;
      height: 45px;
    }
    .header .left {
      position: absolute;
      left: 15px;
    }
    .header .right {
      position: absolute;
      right: 15px;
    }

    /* Centrage image + infos */
    #personDisplay {
      display:flex;
      flex-direction:column;
      align-items:center;
    }
    #personDisplay img {
      width: 200px;
      height: 200px;
      object-fit: cover;
      border-radius: 10px;
      margin-bottom:10px;
    }
    #personDisplay ul {
      font-size: 1.2em;
      line-height: 1.8em;
      list-style:none;
      padding:0;
      margin:0;
      text-align:center;
    }
    #guess {
      font-size: 1.2em;
      padding: 8px;
      width: 250px;
      margin-top:10px;
    }

    /* Palette caractères spéciaux */
    .special-chars {
      margin-top: 5px;
    }
    .special-chars span {
      cursor: pointer;
      font-size: 1.3em;
      margin-right: 8px;
      padding: 3px 6px;
      border:1px solid #ccc;
      border-radius:4px;
      background:#f9f9f9;
    }
    .special-chars span:hover {
      background:#e0e0e0;
    }

    /* Responsive */
    @media (max-width: 900px) {
      .container { 
        flex-direction:column; 
        align-items:center; 
      }
      .toolbox { 
        border-left:none; 
        border-top:2px solid #ccc; 
        width:95%; 
        margin-top:20px;
      }
      #guess { width: 90%; }
    }
	h1 {
    text-align: center;
    color: #333;
  }

  .controls {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }

  .controls input, .controls select, .controls button {
    padding: 10px 15px;
    font-size: 16px;
    border-radius: 8px;
    border: 1px solid #ccc;
  }

  .controls button {
    background-color: #007bff;
    color: #fff;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.2s ease;
  }

  .controls button:hover {
    background-color: #0056b3;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 20px;
  }

  .card {
    background-color: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    padding: 15px;
    text-align: center;
    transition: transform 0.2s;
  }

  .card:hover {
    transform: translateY(-5px);
  }

  .card img {
    width: 100%;
    height: 180px;
    object-fit: cover;
    border-radius: 10px;
    margin-bottom: 10px;
  }

  .card h3 {
    margin: 5px 0;
    font-size: 18px;
    color: #333;
  }

  .card p {
    margin: 0;
    color: #666;
  }
  
	font-family: Arial, sans-serif;
		  display: flex;
		  justify-content: center;
		  align-items: center;
		  height: 100vh;
		  background: linear-gradient(to right, #6a11cb, #2575fc);
		  margin: 0;
		}

		.btn-trombi {
		  padding: 20px 40px;
		  font-size: 1.5rem;
		  font-weight: bold;
		  color: #fff;
		  background: linear-gradient(to right, #ff416c, #ff4b2b);
		  border: none;
		  border-radius: 12px;
		  cursor: pointer;
		  box-shadow: 0 6px 12px rgba(0,0,0,0.2);
		  transition: all 0.3s ease;
		}

		.btn-trombi:hover {
		  transform: translateY(-3px);
		  box-shadow: 0 10px 20px rgba(0,0,0,0.3);
		}
  </style>
</head>
<body>
	
	<!-- Google Tag Manager (noscript) -->
	<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5X9NDHBP"
	height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
	<!-- End Google Tag Manager (noscript) -->
	
  <div class="header">
	<img src="Logo.png" alt="Arts et Métiers d'Angers" class="left">
    Compilons à nos surn's (2025/2026)
    <img src="Buzzy.png" alt="bourdon" class="right">
  </div>

  <div class="error" id="errorBox"></div>
  
  <h1>Trombinoscope</h1>

	<div class="controls">
	  <input type="text" id="search" placeholder="Rechercher un membre...">
	  <select id="sort">
		  <option value="name">Trier par nom</option>
		  <option value="prenom">Trier par prénom</option>
		  <option value="surnom">Trier par surnom</option>
		  <option value="family">Trier par numéro de famille</option>
	  </select>
	  <button id="refreshBtn" onclick="renderGrid()">Actualiser</button>
	</div>

	<div class="grid" id="grid"></div>
<script>


	function ouvrirTrombi() {
      window.open('trombinoscope.html', '_blank');
    }

  function insertCharTo(inputId,char){
    const input=document.getElementById(inputId);
    const start=input.selectionStart;
    const end=input.selectionEnd;
    input.value=input.value.slice(0,start)+char+input.value.slice(end);
    input.focus();
    input.selectionStart=input.selectionEnd=start+char.length;
  }

  /********************
   * NORMALISATION ET TOLÉRANCE
   ********************/
  function normalizeString(str){
    return str
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g,"") 
      .toLowerCase()
      .replace(/['’`]/g,"")
      .replace(/[-_]/g," ")
      .replace(/\s+/g," ")
      .trim();
  }

  function levenshtein(a,b){
    const m=a.length, n=b.length;
    const dp=Array.from({length:m+1},()=>Array(n+1).fill(0));
    for(let i=0;i<=m;i++) dp[i][0]=i;
    for(let j=0;j<=n;j++) dp[0][j]=j;
    for(let i=1;i<=m;i++){
      for(let j=1;j<=n;j++){
        const cost=a[i-1]===b[j-1]?0:1;
        dp[i][j]=Math.min(
          dp[i-1][j]+1,
          dp[i][j-1]+1,
          dp[i-1][j-1]+cost
        );
        if(i>1 && j>1 && a[i-1]===b[j-2] && a[i-2]===b[j-1])
          dp[i][j]=Math.min(dp[i][j],dp[i-2][j-2]+1);
      }
    }
    return dp[m][n];
  }

  function isPermissiveMatch(guess, correct) {
    const g = normalizeString(guess);
    const c = normalizeString(correct);
    if (!c || !g) return false;
    if (g === c) return true;
    if (g.length < Math.min(3, Math.floor(c.length / 3))) return false;
    if (g.length > c.length * 1.5) return false;
    const dist = levenshtein(g, c);
    const len = Math.max(c.length, 1);
    const similarity = 1 - dist / len;
    let minSimilarity;
    if (len <= 5) minSimilarity = 0.8;
    else if (len <= 10) minSimilarity = 0.7;
    else if (len <= 20) minSimilarity = 0.6;
    else minSimilarity = 0.55;
    return similarity >= minSimilarity;
  }

const initialPeople = [
    { prenom:'Lisa', nom:'Abbes', surnom:'Tym[Au]', numero:'56~53block', photo:'Trombinoscope/Lisa_Abbes.png' , tél: "0695724082"},
	{ prenom:'Stanislas', nom:'Allier', surnom:'La Bete', numero:'114-109', photo:'Trombinoscope/Stanislas_Allier.jpg' , tél: "0771882717"},
	{ prenom:'Chloé', nom:'Andre', surnom:'ShuPre[C]', numero:'10', photo:'Trombinoscope/Chloé_Andre.jpg' , tél: "0769747732"},
	{ prenom:'Venance', nom:'Andriamihantamanana', surnom:'[Molo]²', numero:'119-155', photo:'Trombinoscope/Venance_Andriamihantamanana.jpg' , tél: "0666955018"},
	{ prenom:'Kenzo', nom:'Andrieu', surnom:'Djir[L]', numero:'154-18~11', photo:'Trombinoscope/Kenzo_Andrieu.jpg' , tél: "0629920827"},
	//{ prenom:'Antoine', nom:'Archevêque', surnom:'??', numero:'??', photo:'Trombinoscope/Antoine_Archevêque.jpg' , tél: ""},
	{ prenom:'Élise', nom:'Arnaud', surnom:'Tosp[i]n', numero:'129-59♥-128', photo:'Trombinoscope/Élise_Arnaud.jpg' , tél: "0772288644"},
	{ prenom:'Fatima Ezzahra', nom:'Ataf', surnom:'π-ta[F]', numero:'81-48', photo:'Trombinoscope/Fatima Ezzahra_Ataf.png' , tél: "0635001558"},
	{ prenom:'Margaux', nom:'Bagas', surnom:'Ar[T]mis', numero:'79', photo:'Trombinoscope/Margaux_Bagas.jpg' , tél: "0626995309"},
	{ prenom:'Bastien', nom:'Balbine-Le Corre', surnom:'Fen [T]', numero:'6', photo:'Trombinoscope/Bastien_Balbine-Le Corre.jpg' , tél: "0641043342"},
	{ prenom:'Achille', nom:'Bazard', surnom:'Youri', numero:'122', photo:'Trombinoscope/Achille_Bazard.jpg' , tél: "0637230135"},
	{ prenom:'Mathis', nom:'Bazin', surnom:'[AM]ᵀjor[ette]⁰', numero:'87', photo:'Trombinoscope/Mathis_Bazin.jpg' , tél: "0647481733"},
	{ prenom:'Gwendal', nom:'Belliot', surnom:'B[L]idi[O]', numero:'29', photo:'Trombinoscope/Gwendal_Belliot.jpg' , tél: "0788866503"},
	{ prenom:'Élouan', nom:'Bernard', surnom:'Ampozit°', numero:'69', photo:'Trombinoscope/Elouan_Bernard.png' , tél: "0780376331"},
	{ prenom:'Ibrahim', nom:'Berrada Badaoui', surnom:'Vord', numero:'112-80', photo:'Trombinoscope/Ibrahim_Berrada Badaoui.png' , tél: "694-840210"},
	{ prenom:'Clément', nom:'Biver', surnom:'DeT[R]', numero:'46', photo:'Trombinoscope/Clément_Biver.png' , tél: "0763719701"},
	{ prenom:'Noah', nom:'Blandin', surnom:"Toler's", numero:'133-125', photo:'Trombinoscope/Noah_Blandin.jpg' , tél: "0636151954"},
	{ prenom:'Maxence', nom:'Bordin', surnom:'Pr[&]ci pisse', numero:'258~(125)^0~(133)^0', photo:'Trombinoscope/Maxence_Bordin.jpg' , tél: "0770095373"},
	{ prenom:'Baptiste', nom:'Bourdin', surnom:'Kamikaze', numero:'134', photo:'Trombinoscope/Baptiste_Bourdin.jpg' , tél: "0768825717"},
	{ prenom:'Victor', nom:'Bourdin', surnom:'??', numero:'??', photo:'Trombinoscope/Victor_Bourdin.jpg' , tél: "0755610514"},
	{ prenom:'Thomas', nom:'Bourdon', surnom:'Vespula', numero:'84', photo:'Trombinoscope/Thomas_Bourdon.png' , tél: "0631495722"},
	{ prenom:'Aurélien', nom:'Bouton', surnom:"D'[Au]R", numero:'99-127', photo:'Trombinoscope/Aurélien_Bouton.jpg' , tél: "0769544188"},
	{ prenom:'Raslene', nom:'Braiek', surnom:"a[B]i[MV]", numero:'7', photo:'Trombinoscope/Raslene_Braiek.jpg' , tél: "+216 25 717 793"},
	{ prenom:'Aristide', nom:'Brasille', surnom:'Multiprix', numero:'136-169 Djellaba', photo:'Trombinoscope/Aristide_Brasille.jpg' , tél: "0762157690"},
	{ prenom:'Jim', nom:'Brasseur', surnom:"Adémon[T][D]TTan's", numero:'13', photo:'Trombinoscope/Jim_Brasseur.jpg' , tél: "0750223058"},
	{ prenom:'Gaspard', nom:'Bresch', surnom:'Si[A]te', numero:'9', photo:'Trombinoscope/Gaspard_Bresch.jpg' , tél: "0785933478"},
	{ prenom:'Martin', nom:'Brillouet', surnom:"Big'oüdi", numero:'30-50', photo:'Trombinoscope/Nathan_Brioullet.jpg' , tél: "0782266854"},
	{ prenom:'Florence', nom:'Brizion', surnom:'Médi[6]', numero:'19', photo:'Trombinoscope/Florence_Brizon.png' , tél: "0628840731"},
	{ prenom:'Louan', nom:'Buan', surnom:'2minma(X)**0', numero:'158-90', photo:'Trombinoscope/Louan_Buan.jpg' , tél: "0695614804"},
	{ prenom:'Étienne', nom:'Caillet', surnom:'Fines Herbes', numero:'74-57', photo:'Trombinoscope/Étienne_Caillet.jpg' , tél: "0750570474"},
	{ prenom:'Fallou', nom:'Camara', surnom:'Dolce', numero:'32♥', photo:'Trombinoscope/Fallou_Camara.jpg' , tél: "0753104674"},
	{ prenom:'Paul', nom:'Caron', surnom:"[K]r's", numero:'168-132', photo:'Trombinoscope/Paul_Caron.jpg' , tél: "0783273619"},
	{ prenom:'Valentin', nom:'Charles', surnom:'Le[V]', numero:'8', photo:'Trombinoscope/Valentin_Charles.png' , tél: "0619518384"},
	{ prenom:'Léonard', nom:'Chauvin', surnom:'[B]rbe', numero:'78 (121-89)', photo:'Trombinoscope/Léonard_Chauvin.jpg' , tél: "0782662231"},
	{ prenom:'Aloïs', nom:'Chombart de Lauwe', surnom:'Berouj', numero:'180-107', photo:'Trombinoscope/Aloïs_Chombard.jpg' , tél: "0640917070"},
	{ prenom:'Enzo', nom:'Cingal', surnom:'Alfa[2][S]', numero:'169Djelaba136', photo:'Trombinoscope/Enzo_Cingal.jpg' , tél: "0695045495"},
	{ prenom:'Arthus', nom:'Colas', surnom:'[&]Nico', numero:'173-171', photo:'Trombinoscope/Arthus_Colas.jpg' , tél: "0777701610"},
	{ prenom:'Louise', nom:'Collomb', surnom:'Yat[A]k', numero:'103', photo:'Trombinoscope/Louise_Collomb.png' , tél: "0649800379"},
	{ prenom:'François', nom:'Colluard', surnom:'??', numero:'7', photo:'Trombinoscope/François_Colluard.png' , tél: "0781838646"},
	{ prenom:'Marie-Lou', nom:'Cossé', surnom:'Kyl[T]', numero:'89-121-78', photo:'Trombinoscope/Marie-Lou_Cossé.jpg' , tél: "0769196960"},
	{ prenom:'Enzo', nom:'Courseault-Proteau', surnom:"Ktapa[δij]'S", numero:'145-65', photo:'Trombinoscope/Enzo_Courseault-Proteau.jpg' , tél: "0658879773"},
	{ prenom:'Benoît', nom:'Créalet', surnom:'Zage', numero:'141-118~118-141', photo:'Trombinoscope/Benoît_Créalet.jpg' , tél: "0769668956"},
	{ prenom:'Nathan', nom:'Crinon', surnom:'Bin[R]', numero:'45', photo:'Trombinoscope/Nathan_Crinon.jpg' , tél: "0783779542"},
	{ prenom:'Foulques', nom:'Dauce', surnom:'[K]lva', numero:'95♥-190', photo:'Trombinoscope/Foulques_Dauce.jpg' , tél: "0766722472"},
	{ prenom:'Emilio', nom:'D’Azevedo Neves', surnom:'Samoal', numero:'7i', photo:'Trombinoscope/Emilio_D’Azevedo Neves.jpg' , tél: "0647314797"},
	{ prenom:'Xavier', nom:'de Teyssier', surnom:'[T]ra’S', numero:'43', photo:'Trombinoscope/Xavier_De Teyssier.jpg' , tél: "0777370110"},
	{ prenom:'Nolann', nom:'Decurey', surnom:'M[E]l à Meth', numero:'66-149', photo:'Trombinoscope/Nolann_Decurey.jpg' , tél: "0768538621"},
	{ prenom:'Noa', nom:'Defontaine', surnom:'[2]Joüvence', numero:'35', photo:'Trombinoscope/Noa_Defontaine.jpg' , tél: "0681239559"},
	{ prenom:'Maxence', nom:'Depret', surnom:'[P]rvier', numero:'167', photo:'Trombinoscope/Maxence_Depret.jpg' , tél: "0771152245"},
	{ prenom:'Cyrille', nom:'de Gélis', surnom:'Hareng', numero:'123-80', photo:'Trombinoscope/Cyrille_De Gélis.jpg' , tél: "0652662489"},
	{ prenom:'Jim', nom:'de Laborde De Monpezat', surnom:'[O]pper', numero:'101 nike', photo:'Trombinoscope/Jim_De Laborde De Monpezat.jpg' , tél: "0750223058"},
	{ prenom:'Wandrille', nom:'de Montfort', surnom:'Khlys', numero:'157', photo:'Trombinoscope/Wandrille_De Montfort.jpg' , tél: "0636112513"},
	//{ prenom:'Arthur', nom:'de Oliveira Lopes', surnom:'??', numero:'??', photo:'Trombinoscope/Arthur_De Oliveira Lopes.jpg' , tél: ""},
	{ prenom:'Jean-Denis', nom:'de Robillard', surnom:'Strike', numero:'911', photo:'Trombinoscope/Jean-Denis.jpg' , tél: "0762684679"},
	{ prenom:'Baptiste', nom:'Desmars', surnom:'L[A][B][K]ne', numero:'15-82', photo:'Trombinoscope/Baptiste_Desmars.jpg' , tél: "0768296138"},
	{ prenom:'Malo', nom:'Dessard', surnom:'seg[a]', numero:'144', photo:'Trombinoscope/Malo_Dessard.jpg' , tél: "0652941527"},
	{ prenom:'Philippe', nom:'Drouineau', surnom:'A[τ]s', numero:'135', photo:'Trombinoscope/Philippe_Drouineau.jpg' , tél: "0767375156"},
	{ prenom:'Clément', nom:'Ducy', surnom:'Flard', numero:'127-99', photo:'Trombinoscope/Clément_Ducy.jpg' , tél: "0788232080"},
	{ prenom:'Marie', nom:'Dumasdelage', surnom:"Del’Or", numero:'96', photo:'Trombinoscope/Marie_Dumasdelage.jpg'  , tél: "0769187667"},
	{ prenom:'Augustin', nom:'Duplessy', surnom:"Fyl[u-u]’s", numero:'121-89-78', photo:'Trombinoscope/Augustin_Duplessy.jpg'  , tél: "0780847531"},
	{ prenom:'Yvan', nom:'Extrêmes', surnom:'Mc-Ron[X]plos!on', numero:'75', photo:'Trombinoscope/Yvan_Extrêmes.jpg'  , tél: "0769174735"},
	//{ prenom:'Alex', nom:'Eynard', surnom:'??', numero:'??', photo:'Trombinoscope/Alex_Eynard.jpg' , tél: ""},
	{ prenom:'Antoine', nom:'Fauchois', surnom:'bat', numero:'55-4-51', photo:'Trombinoscope/Antoine_Fauchois.jpg' , tél: "0783906321"},
	{ prenom:'Pedro', nom:'Fernandes', surnom:'Lekch[X]', numero:'21-97', photo:'Trombinoscope/Pedro_Fernandes.jpg' , tél: "0769948178"},
	{ prenom:'Thomas', nom:'Flon', surnom:'[A]’lakrem', numero:'112', photo:'Trombinoscope/Thomas_Flon.jpg' , tél: "0652208937"},
	{ prenom:'Steeve', nom:'Foucher', surnom:"Eveet'∫", numero:'53block~56', photo:'Trombinoscope/Steeve_Foucher.jpg' , tél: "0604456474"},
	{ prenom:'Lilian', nom:'Furio', surnom:'Ori[π]ler', numero:'54', photo:'Trombinoscope/Lilian_Furio.jpg' , tél: "0640767134"},
	{ prenom:'Brieuc', nom:'Gac', surnom:'Coüch[&]', numero:'67-65', photo:'Trombinoscope/Brieuc_Gac.jpg' , tél: "0772216323"},
	{ prenom:'Théo', nom:'Gauchot', surnom:'[FA]SHOW', numero:'23', photo:'Trombinoscope/Théo_Gauchot.jpg' , tél: "0621691070"},
	{ prenom:'Léopold', nom:'Gennequin', surnom:'Morpheus', numero:'70-60', photo:'Trombinoscope/Léopold_Gennequin.png' , tél: "0783943132"},
	{ prenom:'Benjamin', nom:'Genon Mandy', surnom:'Jamy', numero:'90-158', photo:'Trombinoscope/Benjamin_Genon Mandy.jpg' , tél: "0665243929"},
	{ prenom:'Arthur', nom:'Georget', surnom:"S'[T]b[A]n", numero:'48-81', photo:'Trombinoscope/Arthur_Georget.jpg' , tél: "0663437965"},
	{ prenom:'Clarisse', nom:'Gerbaud', surnom:'Boeing ', numero:'911', photo:'Trombinoscope/Clarisse_Gerbaud.jpg' , tél: "0649591148"},
	{ prenom:'Fiona', nom:'Gigou', surnom:'Lag', numero:'3', photo:'Trombinoscope/Fiona_Gigou.jpg' , tél: "0679994355"},
	{ prenom:'Constantin', nom:'Gillet', surnom:"Pas lar's de la", numero:'161~', photo:'Trombinoscope/Constantin_Gillet.jpg' , tél: "0634459455"},
	{ prenom:'Timothée', nom:'Gloannec', surnom:'[C]Lent', numero:'115-31', photo:'Trombinoscope/Timothée_Gloannec.jpg' , tél: "0767003587"},
	{ prenom:'Simon', nom:'Godin', surnom:'Fred', numero:'90-158', photo:'Trombinoscope/Simon_Godin.jpg' , tél: "0787696052"},
	{ prenom:'Mariam', nom:'Gohar', surnom:'Sph[1]x', numero:'52-42', photo:'Trombinoscope/Mariam_Gohar.jpg' , tél: "0644769783"},
	{ prenom:'Bertille', nom:'Gouranton', surnom:'Ladybag', numero:'164', photo:'Trombinoscope/Bertille_Gouranton.jpg' , tél: "0627873460"},
	//{ prenom:'Théo', nom:'Grammont', surnom:'??', numero:'??', photo:'Trombinoscope/Théo_Grammont.jpg' , tél: ""},
	{ prenom:'Alexis', nom:'Grould', surnom:'[π]R', numero:'39', photo:'Trombinoscope/Alexis_Grould.jpg' , tél: "0621345807"},
	{ prenom:'Baptiste', nom:'Guemas', surnom:'[1]´s tiK', numero:'151', photo:'Trombinoscope/Baptiste_Guemas.jpg' , tél: "0781376954"},
	//{ prenom:'Flavien', nom:'Guerrier-Hay', surnom:"??", numero:'??', photo:'Trombinoscope/Flavien_Guerrier-Hay.jpg' , tél: ""},
	{ prenom:'Aurélien', nom:'Guieu', surnom:'Abaddon', numero:'18-154~(11)^0', photo:'Trombinoscope/Aurélien_Guieu.jpg' , tél: "0632068238"},
	{ prenom:'Hermès', nom:'Guilbert', surnom:'Bodycount', numero:'148-22', photo:'Trombinoscope/Hermès_Guilbert.jpg' , tél: "0769920119"},
	{ prenom:'Eliot', nom:'Guitton', surnom:'iiist', numero:'111', photo:'Trombinoscope/Eliot_Guitton.jpg' , tél: "0614317762"},
	{ prenom:'Ali', nom:'Hassny', surnom:'⁠[e^x]pre’∫', numero:'⁠92-160-116', photo:'Trombinoscope/Ali_Hassny.jpg' , tél: "0748770388"},
	{ prenom:'Louis', nom:'Hazard', surnom:'viensbriserlacharte dansma', numero:'106-113', photo:'Trombinoscope/Louis_Hazard.jpg' , tél: "0601297168"},
	{ prenom:'Lilian', nom:'Hintzy', surnom:'Poket', numero:'51-4-55', photo:'Trombinoscope/Lilian_Hintzy.jpg' , tél: "0637674973"},
	{ prenom:'Mathias', nom:'Houari-Zaniroli', surnom:'Kéfué', numero:'152', photo:'Trombinoscope/Mathias_Houari-Zaniroli.jpg' , tél: "0780406875"},
	{ prenom:'Arthur', nom:'Houëix', surnom:'[β]mèche', numero:'102P-38', photo:'Trombinoscope/Arthur_Houëix.jpg' , tél: "0643892049"},
	{ prenom:'Yoann', nom:'Jahier', surnom:"Kra[♥]‘s", numero:'143-126', photo:'Trombinoscope/Yoann_Jahier.jpg' , tél: "0670058157"},
	{ prenom:'Florian', nom:'Jégo', surnom:'Toboon', numero:'98', photo:'Trombinoscope/Florian_Jégo.jpg' , tél: "??"},
	{ prenom:'Erwan', nom:'Jehanno', surnom:'Le [Q]sec', numero:'22-148', photo:'Trombinoscope/Erwan_Jehanno.jpg' , tél: "0640506992"},
	{ prenom:'Louis', nom:'Jouvence', surnom:'Emile', numero:'2', photo:'Trombinoscope/Louis_Jouvence.jpg' , tél: "0633053111"},
	{ prenom:'Aymann', nom:'Kheiri', surnom:'HU', numero:'HU', photo:'Trombinoscope/Aymann_Kheiri.jpg' , tél: "??"},
	{ prenom:'Tyfenn', nom:'Kiev', surnom:'n[n]', numero:'178-138', photo:'Trombinoscope/Tyfenn_Kiev.jpg' , tél: "0617689075"},
	{ prenom:'Julie', nom:'Klein', surnom:'Mabawa', numero:'88-44', photo:'Trombinoscope/Old_Julie_Klein.jpg' , tél: "0626706074"},
	{ prenom:'Andéol', nom:'Lallemand', surnom:'Kwalität', numero:'105♥-12', photo:'Trombinoscope/Andéol_Lallemand.jpg' , tél: "0652929481"},
	{ prenom:'Paul', nom:'Landais', surnom:'Ladronᵀ', numero:'124-33', photo:'Trombinoscope/Paul_Landais.jpg' , tél: "0768465225"},
	{ prenom:'Jean-Eudes', nom:'Lantz', surnom:'Vi[J]', numero:'1', photo:'Trombinoscope/Jean-Eudès_Lantz.jpg' , tél: "0615998530"},
	{ prenom:'Thibault', nom:'Le Baron', surnom:'Roüge', numero:'60-70', photo:'Trombinoscope/Thibault_Le Baron.jpg' , tél: "0611316295"},
	{ prenom:'Marie', nom:'de Château-Thierry', surnom:'Ti-grrr[S]', numero:'117', photo:'Trombinoscope/Marie_Le-Bout-De-Chateau-Thierry-De-Beaumanoir.jpg' , tél: "0749901550"},
	{ prenom:'Ethan', nom:'Le Callonnec', surnom:'+[U]ltra', numero:'7²', photo:'Trombinoscope/Ethan_Le Callonnec.jpg' , tél: "0766001742"},
	{ prenom:'Tom', nom:'Lechevalier', surnom:'Perce Val', numero:'156', photo:'Trombinoscope/Tom_Lechevalier.jpg' , tél: "0616251459"},
	{ prenom:'Gabriel', nom:'Le Duff', surnom:'Jvoispal', numero:'142', photo:'Trombinoscope/Gabriel_Le Duff.jpg' , tél: "0666968556"},
	{ prenom:'Jean', nom:'Le Forestier', surnom:'Zipette', numero:'97-(21)', photo:'Trombinoscope/Jean_Le Forestier.png' , tél: "0749180978"},
	{ prenom:'Jules', nom:'Lefort', surnom:'Niké', numero:'335', photo:'Trombinoscope/Jules_Lefort.jpg' , tél: "0608438717"},
	{ prenom:'Timon', nom:'Legal', surnom:'[K]pôn', numero:'72', photo:'Trombinoscope/Timon_Légal.jpg' , tél: "0781226446"},
	{ prenom:'Élouen', nom:'Le Grand', surnom:'Sam²', numero:'27', photo:'Trombinoscope/Élouen_Le Grand.jpg' , tél: "0613678012"},
	{ prenom:'Antoine', nom:'Lelarge', surnom:'Triplix[L]', numero:'153', photo:'Trombinoscope/Antoine_Lelarge.jpg' , tél: "0609698821"},
	{ prenom:'Joseph', nom:'Le Maréchal', surnom:'NoüsV[O]ala', numero:'59♡-129-128', photo:'Trombinoscope/Joseph_Le Maréchal.jpg' , tél: "0784413444"},
	{ prenom:'Diane', nom:'Leroy--Clabault', surnom:'Sun', numero:'41', photo:'Trombinoscope/Diane_Leroy--Clabault.jpg' , tél: "0674102437"},
	{ prenom:'Liam', nom:'Le Tallec', surnom:'Krôh', numero:'5!', photo:'Trombinoscope/Liam_Le Tallec.jpg' , tél: "0695616205"},
	{ prenom:'Clément', nom:'Liège', surnom:'Fonc[L]', numero:'171-173', photo:'Trombinoscope/Clément_Liège.jpg' , tél: "0767079135"},
	{ prenom:'Charles', nom:'Liet', surnom:"Lachok's", numero:'26', photo:'Trombinoscope/Charles_Liet.jpg' , tél: "0643269403"},
	{ prenom:'Thibault', nom:'Loyer', surnom:'Wazulq', numero:'38 102P', photo:'Trombinoscope/Thibault_Loyer.jpg' , tél: "0695040669"},
	{ prenom:'Maxime', nom:'Lugaz', surnom:"Z[A]³ck'∫", numero:'76-86-108', photo:'Trombinoscope/Maxime_Lugaz.jpg' , tél: "0649315189"},
	{ prenom:'Kilian', nom:'Mahé', surnom:'Lal[π]ne', numero:'47', photo:'Trombinoscope/Kilian_Mahé.jpg' , tél: "0749165613"},
	{ prenom:'Romain', nom:'Mancel', surnom:'A[D]', numero:'61-159', photo:'Trombinoscope/Romain_Mancel.jpg' , tél: "0766245685"},
	{ prenom:'Cloé', nom:'Marchand', surnom:'[2π]nar', numero:'5²-5-94-25-155', photo:'Trombinoscope/Cloé_Marchand.jpg' , tél: "0651981610"},
	{ prenom:'Théoping', nom:'Marchix', surnom:'[O][π]che', numero:'130', photo:'Trombinoscope/Théoping_Marchix.jpg' , tél: "0675190280"},
	//{ prenom:'Phénicia', nom:'Marionval', surnom:'??', numero:'??', photo:'Trombinoscope/Phénicia_Marionval.jpg' , tél: ""},
	{ prenom:'Enzo', nom:'Martin', surnom:'[TT]lot', numero:'77', photo:'Trombinoscope/Enzo_Martin.jpg' , tél: "0785054965"},
	{ prenom:'Basile', nom:'Martin', surnom:'Barbalcoolic[E]', numero:'126-143-110-165', photo:'Trombinoscope/Basile_Martin.jpg' , tél: "0781841813"},
	{ prenom:'Côme', nom:'Maunier', surnom:'Avi', numero:'11-18-154', photo:'Trombinoscope/Côme_Maunier.jpg' , tél: "0666136466"},
	{ prenom:'Gabriel', nom:'Méritet', surnom:'Tula', numero:'128-129-59♥', photo:'Trombinoscope/Gabriel_Méritet.jpg' , tél: "0676381193"},
	{ prenom:'Paul', nom:'Métivier', surnom:'[n]Dou!?', numero:'146', photo:'Trombinoscope/Paul_Metivier.jpg' , tél: "0769477827"},
	{ prenom:'Jean', nom:'Mijonnet', surnom:'Glij', numero:'170-71', photo:'Trombinoscope/Jean_Mijonnet.png' , tél: "0601811413"},
	{ prenom:'Lucian', nom:'Millerioux', surnom:'Zaagermeister', numero:'131', photo:'Trombinoscope/Lucian_Millerioux.jpg' , tél: "0684340286"},
	{ prenom:'Baptiste', nom:'Monnier', surnom:"Kho'pate", numero:'73-16', photo:'Trombinoscope/Baptiste_Monnier.jpg' , tél: "0659039049"},
	{ prenom:'Albéric', nom:'Moreaud', surnom:"Grim's", numero:'36', photo:'Trombinoscope/Albéric_Moreaud.jpg' , tél: "0652136450"},
	{ prenom:'Maïan', nom:'Moulinot', surnom:'Himal', numero:'57 & 74', photo:'Trombinoscope/Maïan_Moulinot.jpg' , tél: "0615115866"},
	{ prenom:'Galatée', nom:'Netto', surnom:'Kyla', numero:'58 20 37', photo:'Trombinoscope/Galatée_Netto.jpg' , tél: "0783464655"},
	{ prenom:'Lohann', nom:'Nobilet', surnom:'Lugh', numero:'104', photo:'Trombinoscope/Lohann_Nobilet.jpg' , tél: "0629306005"},
	{ prenom:'Anatole', nom:'Oudot', surnom:'Ch[F]2**2', numero:'24-62', photo:'Trombinoscope/Anatole_Oudot.jpg' , tél: "0782622204"},
	{ prenom:'Lucas', nom:'Palierne', surnom:'Arcass', numero:'85', photo:'Trombinoscope/Lucas_Palierne.jpg' , tél: "0781797095"},
	{ prenom:'Hugo', nom:'Patoux-Soenen', surnom:'Chamon[Q]', numero:'125~133', photo:'Trombinoscope/Hugo_Patoux-Soenen.jpg' , tél: "0602066307"},
	{ prenom:'Mathéo', nom:'Paudois', surnom:'??', numero:'??', photo:'Trombinoscope/Mathéo_Paudois.jpg' , tél: "0698800504"},
	{ prenom:'Vinojan', nom:'Pavarajithan', surnom:'??', numero:'92-160', photo:'Trombinoscope/Vinojan_Pavarajithan.jpg' , tél: "0652492351"},
	{ prenom:'Clément', nom:'Pelletier', surnom:'Lav[N]', numero:'25-155-5²-5-94', photo:'Trombinoscope/Clément_Pelletier.jpg' , tél: "0642420253"},
	{ prenom:'Anaïs', nom:'de Chambure', surnom:'Am[a]batrix', numero:'34(137)°', photo:'Trombinoscope/Anaïs_Chambure.jpg' , tél: "0684882739"},
	{ prenom:'Matthieu', nom:'Perroy', surnom:"Mach'", numero:'100', photo:'Trombinoscope/Matthieu_Perroy.jpg' , tél: "0652098190"},
	{ prenom:'Antonin', nom:'Perseguers', surnom:"[B]’S TONFROK", numero:'139', photo:'Trombinoscope/Antonin_Perseguer.jpg' , tél: "0651439019"},
	{ prenom:'Brieuc', nom:'Poullain', surnom:'Pur 100', numero:'93', photo:'Trombinoscope/Brieuc_Poullain.jpg' , tél: "0602531941"},
	{ prenom:'Simon', nom:'Preault', surnom:"L'Arts", numero:'163 & 63', photo:'Trombinoscope/Simon_Préault.jpg' , tél: "0638219818"},
	{ prenom:'Alexandre', nom:'Quentric', surnom:'Awalp', numero:'XIV', photo:'Trombinoscope/Alexandre_Quentric.jpg' , tél: "0652404757"},
	{ prenom:'Noé', nom:'Quirke', surnom:'[G]z[R]', numero:'28', photo:'Trombinoscope/Noé_Quirke.jpg' , tél: "0769796113"},
	{ prenom:'Enzo', nom:'Rahard', surnom:"La P[R]l's", numero:'62-24', photo:'Trombinoscope/Enzo_Rahard.jpg' , tél: "0767710098"},
	{ prenom:'Pierre-François', nom:'Restif', surnom:'Fañch', numero:'42-52', photo:'Trombinoscope/Pierre-François_Restif.jpg' , tél: "0668538072"},
	{ prenom:'Jean-Emmanuel', nom:'Richard', surnom:'♥[2]Lion', numero:'71-170', photo:'Trombinoscope/Jean-Emmanuel_Richard.jpg' , tél: "0766766168"},
	{ prenom:'Enzo', nom:'Rivière', surnom:'O[φ]ly', numero:'65-67-145', photo:'Trombinoscope/Enzo_Rivière.jpg' , tél: "0762689107"},
	{ prenom:'Benoît', nom:'Robert', surnom:'lad[N]', numero:'147', photo:'Trombinoscope/Benoît_Robert.jpg' , tél: "0618824139"},
	{ prenom:'Azélie', nom:'Rocaboy', surnom:'[D]L', numero:'116-160-59♥', photo:'Trombinoscope/Azélie_Rocaboy.jpg' , tél: "0652981034"},
	{ prenom:'Marion', nom:'Rollier', surnom:"Corakia’s", numero:'68,,', photo:'Trombinoscope/Marion_Rollier.jpg' , tél: "0670218393"},
	{ prenom:'Malo', nom:'Santolalla', surnom:'Tasty', numero:'150∇', photo:'Trombinoscope/Malo_Santolalla.jpg' , tél: "0768125053"},
	{  prenom:'Benjamin', nom:'Sappa', surnom:'M(A)^21RC', numero:'21-(97)^0', photo:'Trombinoscope/Benjamin_Sappa.jpg', tél: "0650782103" },
	{ prenom:'Amr', nom:'Sarhan', surnom:'[A]bout', numero:'40² -140', photo:'Trombinoscope/Amr_Sarhan.jpg' , tél: "0753196157"},
	{ prenom:'Benjamin', nom:'Seguin', surnom:'MaBiquette', numero:'113-106', photo:'Trombinoscope/Benjamin_Seguin.jpg' , tél: "0632698523"},
	{ prenom:'Maria', nom:'Silva', surnom:'Dukunata', numero:'137', photo:'Trombinoscope/Maria_Silva.jpg' , tél: "+55 21 99595-2610"},
	{ prenom:'Nicolas', nom:'Taroux', surnom:"L’[1]pet", numero:'12-105', photo:'Trombinoscope/Nicolas_Taroux.jpg' , tél: "0661146975"},
	{ prenom:'Pierre', nom:'Teissier', surnom:"Cristal's", numero:'155-119', photo:'Trombinoscope/Pierre_Teissier.jpg' , tél: "0651534700"},
	{ prenom:'Lucas', nom:'Teixeira', surnom:"Trakina[H]", numero:'50-30', photo:'Trombinoscope/Lucas_Teixeira.jpg' , tél: "+55 21 99827-5212"},
	{ prenom:'Jules', nom:'Tesson', surnom:'[T]ston', numero:'37-20 (58)°', photo:'Trombinoscope/Jules_Tesson.jpg' , tél: "0651129272"},
	{ prenom:'Marie-Luce', nom:'Teysseyre', surnom:'6[ρ]', numero:'31-115', photo:'Trombinoscope/Marie-Luce_Teysseyre.jpg' , tél: "0769143850"},
	{ prenom:'Mathieu', nom:'Thérond', surnom:'Carrey', numero:'56~53 block', photo:'Trombinoscope/Mathieu_Thérond.jpg' , tél: "0768033393"},
	{ prenom:'Etienne', nom:'Touleau', surnom:'Toüsl[é]', numero:'20-37-(58)°', photo:'Trombinoscope/Etienne_Touleau.jpg' , tél: "0668282279"},
	{ prenom:'Victor', nom:'Valadié', surnom:'Tator', numero:'91', photo:'Trombinoscope/Victor_Valadié.jpg' , tél: "0787374275"},
	{ prenom:'Judith', nom:'Vallin', surnom:'Sanaa', numero:'86 76 108', photo:'Trombinoscope/Judith_Vallin.jpg' , tél: "0611764117"},
	//{ prenom:'Paul', nom:'Van Houtte', surnom:'??', numero:'??', photo:'Trombinoscope/Paul_Van Houtte.jpg' , tél: ""},
	{ prenom:'Hugo', nom:'Verdie-Maucort', surnom:'Trip[O]xx', numero:'40', photo:'Trombinoscope/Hugo_Verdie-Maucort.jpg' , tél: "0769005759"},
	{ prenom:'Lilian', nom:'Verrier', surnom:'Vidlô', numero:'44-88', photo:'Trombinoscope/Lilian_Verrier.jpg' , tél: "0627621328"},
	{ prenom:'Louis', nom:'Videux', surnom:'[T]rium', numero:'190-95♥', photo:'Trombinoscope/Louis_Videux.jpg' , tél: "0788062616"},
	{ prenom:'Oscar', nom:'Villemer', surnom:'[O]dia 4', numero:'51-55', photo:'Trombinoscope/Oscar_Villemer.jpg' , tél: "0782512770"},
	{ prenom:'Oscar', nom:'Wambergue', surnom:'Gamb[R]ge', numero:'94-5-5²', photo:'Trombinoscope/Oscar_Wambergue.jpg' , tél: "0669161061"},
	{ prenom:'Yann', nom:'Zannier', surnom:'Apa', numero:'33-124', photo:'Trombinoscope/Yann_Zannier.jpg' , tél: "0768650642"},
  ];


  initialPeople.forEach(p => {
	  if (!p.photo || p.photo.toString().trim() === "") {
		p.photo = 'Contact.png'; 
	  }
	});

  const fields = ['prenom','nom','surnom','numero'];
  let lists = [];
  let current = null, hiddenField = null;
  let cycleQueue = [], cyclesDone = 0, maxCycles = 4;
  let lives = 3, initialLives = 3, attemptLocked=false;
  let gameCount = parseInt(localStorage.getItem("gameCount")||"0");
  let correctAnswers = 0;

  let activeFields = [...fields];

  /********************
   * MOT DE PASSE
   ********************/
  let unlocked = true;
updateLockState();

window.addEventListener("load", function() {
  try {
    init(); 
  } catch (e) {
    console.warn("init() a levé une exception (élément manquant) :", e);
  }
  actualise(); 
});

  function updateLockState(){
  const disable = !unlocked;
  document.querySelectorAll("#listBox input, #listBox button, #personBox input, #personBox button")
    .forEach(el=> el.disabled=disable);


  document.querySelectorAll(".char-btn").forEach(btn => btn.disabled = disable);
}
  /********************
   * GESTION DES LISTES
   ********************/
  function genId(){ return Math.random().toString(36).substr(2,9); }
  function makeDefaultList(){
    return { id: genId(), name:"Promo 2025", people: initialPeople.map(p=>({...p,id:genId()})) };
  }
  function loadLists(){ return JSON.parse(localStorage.getItem("lists")||"[]"); }
  function saveLists(l){ localStorage.setItem("lists",JSON.stringify(l)); }
  function getActiveList(){ return lists.find(l=>l.active); }
  function setActiveList(id){ lists.forEach(l=>l.active=(l.id===id)); saveLists(lists); }

  function shuffle(a){ for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];} }

  function prepareCycle(){
    const active=getActiveList(); if(!active) return;
    cycleQueue=[];
    active.people.forEach(p=>{
      const f=activeFields[Math.floor(Math.random()*activeFields.length)];
      cycleQueue.push({person:p,field:f});
    });
    shuffle(cycleQueue);
    cyclesDone++;
  }

	function actualise() {
  try {
    if (!Array.isArray(lists) || lists.length === 0) {
      lists = [ makeDefaultList() ];
      lists[0].active = true;
      saveLists(lists);
    } else if (!lists.some(l => l.active)) {
      lists[0].active = true;
      saveLists(lists);
    }


    const search = document.getElementById('search');
    if (search) search.addEventListener('input', renderGrid);

    const sort = document.getElementById('sort');
    if (sort) sort.addEventListener('change', renderGrid);


    renderGrid();
  } catch (err) {
    console.error("Erreur dans actualise() :", err);
  }
}

  function pickNext(){
    if(cycleQueue.length===0){
      if(cyclesDone>=maxCycles){ 
        gameOver(); 
        return;
      }
      prepareCycle();
    }
    const next=cycleQueue.pop();
    current=next.person; hiddenField=next.field;
    renderCurrent(); 
    document.getElementById("remaining").textContent=cycleQueue.length;
  }

function cleanPhone(raw) {
  if (!raw) return "";
  let s = raw.toString().trim();
  // garde + et chiffres
  let num = s.replace(/[^\d+]/g, "");
  // si commence par 0 on convertit en +33 pour la génération de lien wa
  if (num.startsWith("0")) num = "+33" + num.slice(1);
  // si commence sans + on ajoute +
  if (!num.startsWith("+")) num = "+" + num;
  return num;
}

function formatFrenchLocalFromPlus33(num) {
  // attend +33 suivi de 9 chiffres
  let digits = num.replace(/[^\d]/g, "");
  if (digits.startsWith("33") && digits.length === 11) {
    // retourne sous forme 0X XX XX XX XX
    let local = '0' + digits.slice(2);
    return local.replace(/(\d{2})(?=\d)/g, "$1 ").trim();
  }
  return null;
}


  function formatPhoneDisplay(num) {
  if (!num) return "";
  // num est attendu sous forme +... (cleanPhone)
  const rawDigits = num.replace(/[^\d+]/g, "");

  // FRANCE : +33...
  const frenchLocal = formatFrenchLocalFromPlus33(rawDigits);
  if (frenchLocal) return frenchLocal; // ex: "06 95 72 40 82"

  // BRÉSIL : +55 DDD(2) + 9 chiffres -> +55 21 99595-2610
  if (/^\+55\d{11}$/.test(rawDigits)) {
    return rawDigits.replace(/^\+55(\d{2})(\d{5})(\d{4})$/, "+55 $1 $2-$3");
  }

  // UK mobile typical +447xxxxxxxxx -> +44 7XXX XXX XXX
  if (/^\+447\d{9}$/.test(rawDigits)) {
    return rawDigits.replace(/^\+44(7\d{3})(\d{3})(\d{3})$/, "+44 $1 $2 $3");
  }

  // USA/CA
  if (/^\+1\d{10}$/.test(rawDigits)) {
    return rawDigits.replace(/^\+1(\d{3})(\d{3})(\d{4})$/, "+1 ($1) $2-$3");
  }

  // Autres pays : affiche +CC XX XX ... (groupe de 2 après l'indicatif)
  return rawDigits.replace(/^(\+\d{1,3})(\d+)$/, function(_, p, rest) {
    return p + ' ' + rest.replace(/(\d{2})(?=\d)/g, "$1 ").trim();
  });
}

  function renderCurrent(){
  const photoSrc = (current.photo && current.photo.toString().trim()) ? current.photo.toString().trim() : 'Contact.png';

  let html = `<img src="${photoSrc}" alt="photo" onerror="this.onerror=null; this.src='Contact.png'"><ul>`;

  fields.forEach(f=>{
    let label = f==="prenom" ? "Prénom" : f==="nom" ? "Nom" : f==="surnom" ? "Surnom" : "Numéro de la famille";
    html += `<li>${label}: ${f===hiddenField ? "???" : current[f]}</li>`;
  });
  
   html += `<li>Téléphone: ${formatPhoneNumber(current['tél'])}</li>`;

  html += "</ul>";
  document.getElementById("personDisplay").innerHTML = html;
  document.getElementById("guess").value = "";
}

  /********************
   * JEU
   ********************/
  function checkGuess(){
  const g=document.getElementById("guess").value;
  const correct=current[hiddenField]||"";
  attemptLocked=true;

  document.getElementById("btnSetLives").disabled=true;
  document.querySelector("#settingsBox button").disabled=true;

  if(isPermissiveMatch(g, correct)){ 
    correctAnswers++;
    updateScore();
    pickNext(); 
  }
  else { 
    alert("Mauvaise réponse ! La bonne réponse était : " + current[hiddenField]);
    lives--; updateLives();
    if(lives<=0) gameOver(); else pickNext();
  }
}

  function skip(){
    attemptLocked=true;
    document.getElementById("btnSetLives").disabled=true;
    lives-=0.5; updateLives();
    if(lives<=0) gameOver(); else pickNext();
  }

  function updateLives(){ document.getElementById("lives").textContent=lives; }
  function updateScore(){ document.getElementById("score").textContent=correctAnswers; }

  function gameOver(){
  gameCount++; localStorage.setItem("gameCount",gameCount);
  alert("Game Over !");
  const today = new Date();
  const dateStr = today.toLocaleDateString();
  const conformity = (initialLives <= 3 && activeFields.length === 4);
  const score={ 
    run:gameCount, 
    lives:initialLives, 
    correct:correctAnswers, 
    date:dateStr,
    conformity:conformity
  };
  let sc=JSON.parse(localStorage.getItem("scoreboard")||"[]");
  sc.push(score); localStorage.setItem("scoreboard",JSON.stringify(sc));
  renderScoreboard();

  lives=initialLives; updateLives(); cycleQueue=[]; cyclesDone=0; prepareCycle(); pickNext(); attemptLocked=false;
  document.getElementById("btnSetLives").disabled=false;
  document.querySelector("#settingsBox button").disabled=false; 
  correctAnswers=0; updateScore();
}

  function renderScoreboard(){
    let sc=JSON.parse(localStorage.getItem("scoreboard")||"[]");
    sc.sort((a,b)=>b.correct - a.correct); 
    let ul=document.getElementById("scoreboard");
    ul.innerHTML=`
      <table style="width:100%; font-size:0.9em; border-collapse:collapse;">
        <tr style="font-weight:bold; border-bottom:1px solid #aaa;">
          <td>Essai</td><td>Bonnes réponses</td><td>Date</td><td>Conformité</td>
        </tr>
        ${sc.map(s=>`
          <tr>
            <td>${s.run}</td>
            <td>${s.correct}</td>
            <td>${s.date}</td>
            <td style="text-align:center;">${s.conformity ? "✅" : "❌"}</td>
          </tr>`).join("")}
      </table>
    `;
  }

  function clearScoreboard(){
    if(confirm("Effacer le classement ?")){ localStorage.removeItem("scoreboard"); renderScoreboard(); }
  }

  function populateListSelect(){
    let sel=document.getElementById("listSelect"); sel.innerHTML="";
    lists.forEach(l=>{
      let opt=document.createElement("option");
      opt.value=l.id; opt.textContent=l.name; if(l.active) opt.selected=true;
      sel.appendChild(opt);
    });
  }

  function changeList(){
    setActiveList(document.getElementById("listSelect").value); cycleQueue=[]; cyclesDone=0; prepareCycle(); pickNext();
  }
  function createList(){
    let n=document.getElementById("newListName").value.trim(); if(!n) return;
    lists.push({id:genId(),name:n,people:[],active:false}); saveLists(lists); populateListSelect();
  }
  function renameList(){
    let id=document.getElementById("listSelect").value;
    let l=lists.find(x=>x.id===id); if(!l) return;
    l.name=document.getElementById("renameListName").value.trim();
    saveLists(lists); populateListSelect();
  }
  function deleteList(){
    if(!confirm("Supprimer la liste ?")) return;
    let id=document.getElementById("listSelect").value;
    lists=lists.filter(x=>x.id!==id); if(lists.length===0) lists=[makeDefaultList()]; 
    lists[0].active=true; saveLists(lists); populateListSelect();
  }

  function addPerson(){
	  const photoVal = (photo.value && photo.value.trim()) ? photo.value.trim() : 'Contact.png';
	  const p = {
		prenom: prenom.value,
		nom: nom.value,
		surnom: surnom.value,
		numero: numero.value,
		photo: photoVal,
		id: genId()
	  };
	  let act = getActiveList();
	  act.people.push(p);
	  saveLists(lists);
	  cycleQueue = [];
	  cyclesDone = 0;
	  prepareCycle();
	  pickNext();
	  prenom.value = nom.value = surnom.value = numero.value = photo.value = '';
	}

  function setLives(){
    const val=parseInt(prompt("Nombre de vies de départ :", initialLives));
    if(!isNaN(val) && val>0){ initialLives=val; lives=val; updateLives(); }
  }

  // === NOUVEAU : mise à jour des champs activés ===
  function updateHiddenFields(){
    activeFields = [];
    if(document.getElementById("chkPrenom").checked) activeFields.push("prenom");
    if(document.getElementById("chkNom").checked) activeFields.push("nom");
    if(document.getElementById("chkSurnom").checked) activeFields.push("surnom");
    if(document.getElementById("chkNumero").checked) activeFields.push("numero");
    cycleQueue=[]; cyclesDone=0; prepareCycle(); pickNext();
  }

  function init(){
    const storedVersion = localStorage.getItem("initialVersion");
    const currentVersion = JSON.stringify(initialPeople);

    if(storedVersion !== currentVersion){
      lists=[makeDefaultList()];
      lists[0].active=true;
      saveLists(lists);
      localStorage.setItem("initialVersion", currentVersion);
    } else {
      lists=loadLists(); 
      if(lists.length===0){ lists=[makeDefaultList()]; saveLists(lists); }
    }

    if(!lists.some(l=>l.active)) lists[0].active=true;
    saveLists(lists);

    populateListSelect();
    cyclesDone=0; prepareCycle();
    lives=initialLives; updateLives();
    pickNext();
    renderScoreboard();
    updateScore();

    document.getElementById("guess").addEventListener("keydown", e=>{
      if(e.key==="Enter") checkGuess();
    });
  }
  /********************
 * RENDU TROMBINOSCOPE
 ********************/
 function renderGrid() {
  const grid = document.getElementById("grid");
  const searchValue = (document.getElementById("search") && document.getElementById("search").value || "").toLowerCase();
  const sortBy = (document.getElementById("sort") && document.getElementById("sort").value) || 'name';
  let people = (getActiveList && getActiveList()?.people) || initialPeople;

  let filteredPeople = people;
  if (searchValue) {
    filteredPeople = people.filter((p) =>
      (p.prenom + p.nom + (p.surnom||'') + (p.numero||''))
        .toLowerCase()
        .includes(searchValue)
    );
  }

  function firstNumber(str) {
    const match = str && str.toString().match(/\d+/);
    return match ? parseInt(match[0], 10) : null;
  }
  filteredPeople.sort((a, b) => {
    if (sortBy === "name")
      return (a.nom + a.prenom).localeCompare(b.nom + b.prenom);
    if (sortBy === "prenom") return a.prenom.localeCompare(b.prenom);
    if (sortBy === "surnom")
      return (a.surnom || "").localeCompare(b.surnom || "");
    if (sortBy === "family") {
      const numA = firstNumber(a.numero);
      const numB = firstNumber(b.numero);
      if (numA === null && numB === null) return 0;
      if (numA === null) return 1;
      if (numB === null) return -1;
      return numA - numB;
    }
    return 0;
  });

  grid.innerHTML = "";

  if (filteredPeople.length === 0) {
    grid.innerHTML = `<div style="text-align:center; color:#c0392b; font-size:24px;">Aucun chicop's ne correspond à cette description...</div>`;
    return;
  }

  // --- Bouton d'affichage WhatsApp ---
  const toggleBtn = document.createElement("button");
  toggleBtn.textContent = "Afficher les contacts WhatsApp";
  toggleBtn.style = "margin-bottom:15px; padding:8px 15px; font-weight:bold;";
  let waVisible = false;
  toggleBtn.onclick = () => {
    waVisible = !waVisible;
    document.querySelectorAll(".wa-buttons").forEach((div) => {
      div.style.display = waVisible ? "flex" : "none";
    });
    document.querySelectorAll('.phone').forEach(p => {
      p.style.display = waVisible ? 'block' : 'none';
    });
    toggleBtn.textContent = waVisible
      ? "Masquer les contacts WhatsApp"
      : "Afficher les contacts WhatsApp";
  };
  grid.appendChild(toggleBtn);

  filteredPeople.forEach((p) => {
    const photoSrc = p.photo && p.photo.trim() ? p.photo.trim() : "Contact.png";
    const rawPhone = p["tél"] ? cleanPhone(p["tél"]) : ""; // +33... form
    const displayPhone = rawPhone ? formatPhoneDisplay(rawPhone) : "";
    const waLink = rawPhone ? `https://wa.me/${rawPhone.replace(/\D/g, "")}` : null;
    const vcfName = `${p.prenom}_${p.nom}`
      .replace(/\s+/g, "_")
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "");
    const vcfPath = `contacts/${vcfName}.vcf`;

    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <img src="${photoSrc}" alt="photo" onerror="this.onerror=null;this.src='Contact.png'">
      <h3 style="font-family:'Old English Text MT',serif;">${p.prenom} ${p.nom}</h3>
      <p>${p.surnom || "???"} - ${p.numero || "???"}</p>
      <p class="phone" style="display:none; font-size:0.9em;color:#555;">${displayPhone ? "Tél : " + displayPhone : ""}</p>
      <div class="wa-buttons" style="display:none; justify-content:center; gap:8px; margin-top:8px;">
        ${waLink
          ? `<a href="${waLink}" target="_blank"
               style="background:#25D366; color:white; padding:6px 10px;
                      border-radius:6px; text-decoration:none; font-weight:bold;">Message WhatsApp</a>`
          : ""}
        <a href="${vcfPath}" download
           style="background:#007bff; color:white; padding:6px 10px;
                  border-radius:6px; text-decoration:none; font-weight:bold;">Ajouter Contact</a>
      </div>`;
    grid.appendChild(card);
  });

  // --- Carte "Tout ajouter" ---
  const allCard = document.createElement("div");
  allCard.className = "card";
  allCard.style.background = "#f8f9fa";
  allCard.innerHTML = `
    <h3>Toüs en un clic</h3>
    <p>Ajoute l'ensemble des chicop's à ton téléf's.</p>
    <button style="background:#28a745; color:white; padding:10px 15px;
                   border:none; border-radius:8px; cursor:pointer; font-weight:bold;">
      Tout ajouter
    </button>`;
  allCard.querySelector("button").onclick = () => {
    if (confirm("Confirmer l'ajout de tous les contacts WhatsApp ?")) {
      window.location.href = "contacts/contacts_all.vcf";
    }
  };
  grid.appendChild(allCard);
}

window.addEventListener("load", function () {
  renderGrid();
});
</script>

</body>
</html>






